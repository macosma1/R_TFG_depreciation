"0","#---------------------------------------------------#"
"0","  #dim(datos) ## la dimension es de [1] filas=4615 y columnas=2"
"0","  AGE <- unique(datos$years) # obtenemos los AGEs por los que partir el dataframe"
"0",""
"0","#get threshold values for outliers"
"0","  list_quantiles <- tapply(datos$price, datos$years, quantile)"
"0","  Q1s <- sapply(1:length(AGE), function(i) list_quantiles[[i]][2])"
"0","  Q3s <- sapply(1:length(AGE), function(i) list_quantiles[[i]][4])"
"0","  IQRs <- tapply(datos$price, datos$years, IQR)"
"0","  minis <- sapply(1:length(AGE), function(i) list_quantiles[[i]][1])"
"0","  maxis <- sapply(1:length(AGE), function(i) list_quantiles[[i]][5])"
"0","  Mes <- sapply(1:length(AGE), function(i) list_quantiles[[i]][3]) #median"
"0","  MAD <- tapply(datos$price, datos$years, mad)"
"0",""
"0","#Intercuartil"
"0","  Lowers <- Q1s - 1.5*IQRs #valor atípico leve dista --> q < Q1 – 1,5 · IQR o bien q > Q3 + 1,5 · IQR"
"0","  Uppers <- Q3s + 1.5*IQRs "
"0",""
"0","#Hampel filter -->MAD"
"0","  lower_bound <- Mes - 3 * MAD"
"0","  Upper_bound <- Mes + 3 * MAD"
"0",""
"0","#for to collect the data that pass the filter"
"0","  list_year <- split(datos, datos$years)"
"0","  data_no_outlier <- NULL"
"0","  data_no_outlier_Mad <- NULL"
"0","  for (i in 1:length(AGE)){"
"0","    out <- subset(list_year[[i]], list_year[[i]]$price > Lowers[i] & list_year[[i]]$price < Uppers[i]) #Intercuartile range"
"0","    data_no_outlier <- rbind(data_no_outlier, out)"
"0","    #data_no_outlier <- rbind(out)"
"0","    outMad <- subset(list_year[[i]], list_year[[i]]$price > lower_bound[i] & list_year[[i]]$price < Upper_bound[i]) #Hampel filter -->MAD"
"0","    data_no_outlier_Mad<- rbind(data_no_outlier_Mad, outMad)"
"0","  }"
"0",""
"0",""
"0","#dim(data_no_outlier) ## [1] 4297    2"
"0","#dim(data_no_outlier_Mad) ## [1] 4188    2"
"0",""
"0",""
"0","  #------------------------------------------------------------------------------------------  "
"0","#elimino"
"0","  rm(AGE, i, IQRs, lower_bound, Lowers, MAD, maxis, Mes, minis, Q1s, Q3s, Upper_bound, Uppers, out, outMad, list_quantiles, list_year)"
"0","#---------------------------------------------------------------------------------------------------------------------------------------------------"
"0","list_marca <- data_no_outlier_Mad[2]"
"0","data_no_outlier_Mad <- data_no_outlier_Mad %>% mutate(list_marca = ifelse(brand == ""Est"", ""Otro"", brand))      "
"0","data_no_outlier_Mad <- data_no_outlier_Mad [, c (""name"", ""list_marca"", ""country"", ""city"", ""power"", ""price"", ""km"", ""year"", ""years"", ""years.category"")]"
"0","colnames(data_no_outlier_Mad)[2] <- ""brand"""
"0"," rm(list_marca)"
